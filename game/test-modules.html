<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>Test Modules - Horse Maze Game</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
.test-section { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.test-result { padding: 10px; margin: 5px 0; border-radius: 4px; }
.pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
#testResults { max-height: 400px; overflow-y: auto; }
button { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
.btn-primary { background: #007bff; color: white; }
.btn-success { background: #28a745; color: white; }
</style>
</head>
<body>
<h1>ðŸ§ª Module Testing - Horse Maze Game</h1>

<div class="test-section">
  <h2>Test Controls</h2>
  <button class="btn-primary" onclick="runAllTests()">Run All Tests</button>
  <button class="btn-success" onclick="clearResults()">Clear Results</button>
</div>

<div class="test-section">
  <h2>Test Results</h2>
  <div id="testResults"></div>
</div>

<!-- Load modules to test -->
<script src="scripts/config.js"></script>
<script src="scripts/utils.js"></script>
<script src="scripts/ui-handlers.js"></script>
<script src="scripts/game-logic.js"></script>
<script src="scripts/render.js"></script>
<script src="scripts/app.js"></script>

<script>
// Test framework
const TestFramework = {
  results: [],
  
  log(message, type = 'info') {
    this.results.push({ message, type, timestamp: new Date().toISOString() });
    this.updateDisplay();
  },
  
  pass(message) {
    this.log(`âœ… PASS: ${message}`, 'pass');
  },
  
  fail(message) {
    this.log(`âŒ FAIL: ${message}`, 'fail');
  },
  
  info(message) {
    this.log(`â„¹ï¸ INFO: ${message}`, 'info');
  },
  
  updateDisplay() {
    const container = document.getElementById('testResults');
    container.innerHTML = this.results.map(result => 
      `<div class="test-result ${result.type}">${result.message}</div>`
    ).join('');
    container.scrollTop = container.scrollHeight;
  },
  
  clear() {
    this.results = [];
    this.updateDisplay();
  }
};

// Test functions
function testConfigModule() {
  TestFramework.info('Testing CONFIG module...');
  
  try {
    // Test CONFIG exists
    if (typeof window.CONFIG === 'undefined') {
      TestFramework.fail('CONFIG module not loaded');
      return;
    }
    TestFramework.pass('CONFIG module loaded');
    
    // Test required sections
    const requiredSections = ['render', 'physics', 'ui', 'powerUps', 'audio', 'modes'];
    requiredSections.forEach(section => {
      if (window.CONFIG[section]) {
        TestFramework.pass(`CONFIG.${section} exists`);
      } else {
        TestFramework.fail(`CONFIG.${section} missing`);
      }
    });
    
    // Test power-up configs
    const powerUpTypes = ['boost', 'turbo', 'teleport', 'magnet', 'timeFreeze', 'ghost', 'trap', 'ram', 'shield'];
    powerUpTypes.forEach(type => {
      if (window.CONFIG.powerUps && window.CONFIG.powerUps[type]) {
        TestFramework.pass(`PowerUp config for ${type} exists`);
      } else {
        TestFramework.fail(`PowerUp config for ${type} missing`);
      }
    });
    
  } catch (error) {
    TestFramework.fail(`CONFIG module error: ${error.message}`);
  }
}

function testUtilsModule() {
  TestFramework.info('Testing UTILS module...');
  
  try {
    // Test Utils exists
    if (typeof window.Utils === 'undefined') {
      TestFramework.fail('Utils module not loaded');
      return;
    }
    TestFramework.pass('Utils module loaded');
    
    // Test required utilities
    const requiredUtils = ['ErrorHandler', 'MathUtils', 'DOMUtils', 'CanvasUtils', 'PerformanceUtils', 'ValidationUtils', 'StorageUtils', 'ColorUtils'];
    requiredUtils.forEach(util => {
      if (window.Utils[util]) {
        TestFramework.pass(`Utils.${util} exists`);
      } else {
        TestFramework.fail(`Utils.${util} missing`);
      }
    });
    
    // Test MathUtils functions
    const mathResult = window.Utils.MathUtils.clamp(5, 0, 10);
    if (mathResult === 5) {
      TestFramework.pass('MathUtils.clamp works correctly');
    } else {
      TestFramework.fail('MathUtils.clamp failed');
    }
    
    const distance = window.Utils.MathUtils.distance(0, 0, 3, 4);
    if (Math.abs(distance - 5) < 0.001) {
      TestFramework.pass('MathUtils.distance works correctly');
    } else {
      TestFramework.fail('MathUtils.distance failed');
    }
    
    // Test ValidationUtils
    if (window.Utils.ValidationUtils.isNumber(42)) {
      TestFramework.pass('ValidationUtils.isNumber works correctly');
    } else {
      TestFramework.fail('ValidationUtils.isNumber failed');
    }
    
  } catch (error) {
    TestFramework.fail(`Utils module error: ${error.message}`);
  }
}

function testUIHandlersModule() {
  TestFramework.info('Testing UI-HANDLERS module...');
  
  try {
    // Test UIHandlers exists
    if (typeof window.UIHandlers === 'undefined') {
      TestFramework.fail('UIHandlers module not loaded');
      return;
    }
    TestFramework.pass('UIHandlers module loaded');
    
    // Test required methods
    const requiredMethods = ['initializeEventListeners', 'handleToolSelection', 'updateUI', 'showModal'];
    requiredMethods.forEach(method => {
      if (typeof window.UIHandlers[method] === 'function') {
        TestFramework.pass(`UIHandlers.${method} exists`);
      } else {
        TestFramework.fail(`UIHandlers.${method} missing or not a function`);
      }
    });
    
  } catch (error) {
    TestFramework.fail(`UIHandlers module error: ${error.message}`);
  }
}

function testGameLogicModule() {
  TestFramework.info('Testing GAME-LOGIC module...');
  
  try {
    // Test GameLogic exists
    if (typeof window.GameLogic === 'undefined') {
      TestFramework.fail('GameLogic module not loaded');
      return;
    }
    TestFramework.pass('GameLogic module loaded');
    
    // Test required methods
    const requiredMethods = ['initialize', 'update', 'updateHorses', 'checkCollisions', 'reset'];
    requiredMethods.forEach(method => {
      if (typeof window.GameLogic[method] === 'function') {
        TestFramework.pass(`GameLogic.${method} exists`);
      } else {
        TestFramework.fail(`GameLogic.${method} missing or not a function`);
      }
    });
    
  } catch (error) {
    TestFramework.fail(`GameLogic module error: ${error.message}`);
  }
}

function testRenderModule() {
  TestFramework.info('Testing RENDER module...');
  
  try {
    // Test RenderModule exists
    if (typeof window.RenderModule === 'undefined') {
      TestFramework.fail('RenderModule not loaded');
      return;
    }
    TestFramework.pass('RenderModule loaded');
    
    // Test required methods
    const requiredMethods = ['drawDynamicItems', 'drawBoosts', 'drawTurbos', 'drawTeleports'];
    requiredMethods.forEach(method => {
      if (typeof window.RenderModule[method] === 'function') {
        TestFramework.pass(`RenderModule.${method} exists`);
      } else {
        TestFramework.fail(`RenderModule.${method} missing or not a function`);
      }
    });
    
  } catch (error) {
    TestFramework.fail(`RenderModule error: ${error.message}`);
  }
}

function testAppModule() {
  TestFramework.info('Testing APP module...');
  
  try {
    // Test App exists
    if (typeof window.App === 'undefined') {
      TestFramework.fail('App module not loaded');
      return;
    }
    TestFramework.pass('App module loaded');
    
    // Test editor flags
    if (typeof window.editorEmojiEnabled !== 'undefined') {
      TestFramework.pass('editorEmojiEnabled flag exists');
    } else {
      TestFramework.fail('editorEmojiEnabled flag missing');
    }
    
    if (typeof window.editorVectorIconsOnly !== 'undefined') {
      TestFramework.pass('editorVectorIconsOnly flag exists');
    } else {
      TestFramework.fail('editorVectorIconsOnly flag missing');
    }
    
  } catch (error) {
    TestFramework.fail(`App module error: ${error.message}`);
  }
}

function testModuleIntegration() {
  TestFramework.info('Testing module integration...');
  
  try {
    // Test if modules can work together
    const mockGameState = {
      horses: [],
      mode: 'editor',
      running: false
    };
    
    // Test GameLogic initialization
    if (window.GameLogic && window.RenderModule) {
      window.GameLogic.initialize(mockGameState, window.RenderModule);
      TestFramework.pass('GameLogic can initialize with RenderModule');
    }
    
    // Test UIHandlers initialization
    if (window.UIHandlers) {
      const mockGameActions = {
        selectTool: () => {},
        handleCanvasClick: () => {}
      };
      window.UIHandlers.initializeEventListeners(mockGameState, mockGameActions);
      TestFramework.pass('UIHandlers can initialize with mock state');
    }
    
  } catch (error) {
    TestFramework.fail(`Module integration error: ${error.message}`);
  }
}

function runAllTests() {
  TestFramework.clear();
  TestFramework.info('ðŸš€ Starting module tests...');
  
  testConfigModule();
  testUtilsModule();
  testUIHandlersModule();
  testGameLogicModule();
  testRenderModule();
  testAppModule();
  testModuleIntegration();
  
  const passCount = TestFramework.results.filter(r => r.type === 'pass').length;
  const failCount = TestFramework.results.filter(r => r.type === 'fail').length;
  
  TestFramework.info(`ðŸ“Š Test Summary: ${passCount} passed, ${failCount} failed`);
  
  if (failCount === 0) {
    TestFramework.pass('ðŸŽ‰ All tests passed! Modules are ready for integration.');
  } else {
    TestFramework.fail('âš ï¸ Some tests failed. Please fix issues before integration.');
  }
}

function clearResults() {
  TestFramework.clear();
}

// Auto-run tests when page loads
window.addEventListener('load', () => {
  setTimeout(runAllTests, 500);
});
</script>

</body>
</html>
